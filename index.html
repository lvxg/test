<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bmob 数据查询示例</title>
    <!-- 引入 Bmob JavaScript SDK -->
    <script src="https://cdn.jsdelivr.net/npm/hydrogen-js-sdk@2.1.0/dist/Bmob-2.1.0.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 0 20px;
            background-color: #f5f7fa;
        }
        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        h1 {
            font-size: 24px;
            color: #1a1a1a;
            margin: 0 0 10px 0;
        }
        .btn {
            background-color: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        .btn:hover {
            background-color: #1d4ed8;
        }
        .btn:disabled {
            background-color: #93c5fd;
            cursor: not-allowed;
        }
        .content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            min-height: 200px;
        }
        .loading {
            color: #6b7280;
            text-align: center;
            padding: 40px;
        }
        .error {
            color: #dc2626;
            background-color: #fef2f2;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #dc2626;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            text-align: left;
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background-color: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        tr:hover {
            background-color: #f9fafb;
        }
        .empty {
            text-align: center;
            color: #6b7280;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Bmob test 表数据查询</h1>
        <button id="queryBtn" class="btn" onclick="queryData()">点击查询数据</button>
    </div>

    <div class="content" id="resultArea">
        <p style="color: #6b7280; text-align: center;">点击上方按钮查询 test 表数据</p>
    </div>

    <script>
        // ================= 请在此处配置你的 Bmob 密钥 =================
        const APPLICATION_ID = "6a496fc036c469c5e3643e8b1c5a1e8d";  // 替换为你的 Application ID
        const REST_API_KEY = "643e537279e51940a9642d729c378e63";      // 替换为你的 REST API Key
        // ===============================================================

        // 初始化 Bmob
        Bmob.initialize(APPLICATION_ID, REST_API_KEY);

        /**
         * 查询 test 表数据
         */
        async function queryData() {
            const btn = document.getElementById('queryBtn');
            const resultArea = document.getElementById('resultArea');

            // 防止重复点击
            btn.disabled = true;
            resultArea.innerHTML = '<div class="loading">正在查询数据...</div>';

            try {
                // 创建查询对象，参数为表名
                const query = Bmob.Query('test');
                
                // (可选) 设置查询条件，例如按创建时间倒序排列
                query.order("-createdAt");
                
                // (可选) 设置返回条数，默认 10 条，最大 1000 条
                // query.limit(50);

                // 执行查询
                const results = await query.find();
                
                // 渲染结果
                renderResults(results);

            } catch (error) {
                console.error('查询失败:', error);
                resultArea.innerHTML = `
                    <div class="error">
                        <strong>查询失败</strong><br>
                        错误信息: ${error.message || '未知错误'}<br>
                        <small>请检查：1. 密钥是否正确 2. test 表是否存在 3. 表权限是否允许读取</small>
                    </div>
                `;
            } finally {
                btn.disabled = false;
            }
        }

        /**
         * 渲染查询结果到表格
         */
        function renderResults(data) {
            const resultArea = document.getElementById('resultArea');

            if (!data || data.length === 0) {
                resultArea.innerHTML = '<div class="empty">test 表中暂无数据</div>';
                return;
            }

            // 动态获取所有列名（排除 Bmob 内置字段，可选）
            const allKeys = new Set();
            data.forEach(item => {
                Object.keys(item).forEach(key => {
                    // 过滤掉 Bmob 内置的特殊字段，只保留自定义字段
                    if (!['createdAt', 'updatedAt', 'objectId', 'ACL'].includes(key)) {
                        allKeys.add(key);
                    }
                });
            });
            const columns = Array.from(allKeys);

            // 如果没有自定义字段，则显示所有字段
            const displayColumns = columns.length > 0 ? columns : Object.keys(data[0]);

            // 生成表格 HTML
            let tableHtml = `
                <p style="margin: 0 0 15px 0; color: #374151;">共查询到 <strong>${data.length}</strong> 条数据</p>
                <table>
                    <thead>
                        <tr>
                            ${displayColumns.map(col => `<th>${col}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.forEach(row => {
                tableHtml += '<tr>';
                displayColumns.forEach(col => {
                    // 处理对象/数组类型的数据，转为字符串显示
                    let value = row[col];
                    if (typeof value === 'object' && value !== null) {
                        value = JSON.stringify(value);
                    }
                    tableHtml += `<td>${value !== undefined ? value : ''}</td>`;
                });
                tableHtml += '</tr>';
            });

            tableHtml += '</tbody></table>';
            resultArea.innerHTML = tableHtml;
        }
    </script>
</body>
</html>
